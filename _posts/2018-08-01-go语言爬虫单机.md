---
layout:     post
title:      go语言爬虫单机
subtitle:   Single Crawler In Go
date:       2018-08-01
author:     BY
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - Blog
---


## 前言

使用go语言做点东西，跟着网上大神一起学习，做做笔记

## 正文

### 问题来源

本问题来自leetcode上的3题。这道题之前做过，这次用go语言再做一遍

### 问题描述

给定一个字符串，找出不含有重复字符的最长子串的长度。

#### 示例 1:
给定 "abcabcbb" ，没有重复字符的最长子串是 "abc" ，那么长度就是3。  
给定 "bbbbb" ，最长的子串就是 "b" ，长度是1。  
给定 "pwwkew" ，最长子串是 "wke" ，长度是3。请注意答案必须是一个子串，"pwke" 是子序列  而不是子串。  
#### 分析：
暴力解法
go代码如下：  
```
package main

import (
	"net/http"
	"fmt"
	"io/ioutil"
)

func main() {
	resp, err := http.Get("http://www.zhenai.com/zhenhun")
	if err != nil {
		panic(err)
	}
	defer resp.Body.Close()

	if resp.StatusCode == http.StatusOK {
		fmt.Println("Error: status code", resp.StatusCode)
		return
	}

	all, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		panic(err)
	}
	fmt.Printf("%s\n",all)
}
```  
获取到网页上的内容时发现乱码，需要将原来的编码转化为UTF-8编码。
```
package main
import (
	"net/http"
	"fmt"
	"io/ioutil"
	"golang.org/x/text/encoding/simplifiedchinese"
	"golang.org/x/text/transform"
)

func main() {
	resp, err := http.Get("http://www.zhenai.com/zhenhun")
	if err != nil {
		panic(err)
	}
	defer resp.Body.Close()

	if resp.StatusCode == http.StatusOK {
		fmt.Println("Error: status code", resp.StatusCode)
		return
	}
	//这两行是为转码而写
	utf8Reader := transform.NewReader(resp.Body, simplifiedchinese.GBK.NewDecoder())
	all, err := ioutil.ReadAll(utf8Reader)
	if err != nil {
		panic(err)
	}
	fmt.Printf("%s\n",all)
}
```
输入转码的两行代码后，发现idea找不到该包，需要从网上下载  
golang.org/x包放到了https://github.com/golang/text 中，下载时需要先在本地安装目录下src/建立golang.org/x的目录后，再下载。
mkdir -p golang.org/x
git clone https://github.com/golang/text.git 或go get github.com/golang/text后将包移到x目录
这样的写法有些问题，代码将编码写死成GBK到UTF-8。解决的办法有两个：一、在html中的head中检查字符集编码的类型，例如<meta http-equiv="Content-Type" content="text/html; charset=gbk">；二、使用库自动发现网页的编码
我们将采用第二种方法，同样的方法下载golang.org/x/net包
```
package main
import (
	"net/http"
	"fmt"
	"io/ioutil"
	"golang.org/x/text/transform"
	"io"
	"golang.org/x/text/encoding"
	"golang.org/x/net/html/charset"
	"bufio"
)

func main() {
	resp, err := http.Get("http://www.zhenai.com/zhenhun")
	if err != nil {
		panic(err)
	}
	defer resp.Body.Close()

	if resp.StatusCode == http.StatusOK {
		fmt.Println("Error: status code", resp.StatusCode)
		return
	}
	//在这里使用新增函数
	e := determineEncoding(resp.Body)
	utf8Reader := transform.NewReader(resp.Body, e.NewDecoder())
	all, err := ioutil.ReadAll(utf8Reader)
	if err != nil {
		panic(err)
	}
	fmt.Printf("%s\n",all)
}
//新增检查io编码的函数
func determineEncoding(r io.ReadCloser) encoding.Encoding {
	bytes, err := bufio.NewReader(r).Peek(1024)
	if err != nil {
		panic(err)
	}
	e, _, _ := charset.DetermineEncoding(bytes, "")
	return e
}
```
#### 总结：


## 结语
闲来无事的话，多练习练习，做做题。
